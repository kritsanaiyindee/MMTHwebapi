<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {
            packages: ['corechart']
        });
    </script>

    <title>DTS Dashboard</title>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans',sans-serif;
            font-size: 12px;
            padding-top: 0;
            /*color: #777;*/
            background: #f9f9f9;
            margin: 0% 1%;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            background-color: #2E2E2E;
            opacity: 1;
            color: white;
            padding: 0.25% 10px;
            margin: 0.25% 0px;
        }

        #efficiency {
            width: 60%;
        }

        .mydashboard {
            float: left;
            width: 30%;
            /*max-width: 60%;*/
            padding: 2px 2px;
        }

            .mydashboard .content-box {
                margin: 5px;
                box-shadow: 5px 5px #E8E8E8;
            }

                .mydashboard .content-box .subject {
                    font-size: 14px;
                    font-weight: 600;
                    width: 100%;
                    background-color: white;
                    opacity: 0.9;
                    color: #2E2E2E;
                    padding: 2px 10px;
                    margin: 0px 0px 2px 0px;
                }

                .mydashboard .content-box .content {
                    height: 150px;
                }

                .mydashboard .content-box svg {
                    /*width: 100%;
                    max-width: 100%;*/
                    /*padding: 0px;
                    margin: 0px;*/
                }

                .mydashboard .content-box ract {
                    /*width: 100%;
                    max-width: 100%;*/
                    /*padding: 0px;
                    margin: 0px;*/
                }

        .summary {
            float: left;
            width: 20%;
            height: 55px;
            margin: 0px 0.125%;
            padding: 5px 5px 5px 5px;
            color: white;
        }

            .summary .subject {
                font-size: 12px;
                font-weight: 600;
            }

            .summary .content {
                font-size: 22px;
                font-weight: 700;
                text-align: center;
            }

                .summary .content i {
                    font-size: 12px;
                }

            .summary button {
                float: right;
                font-size: 9px;
                background-color: transparent;
                border-color: white;
                border-style: solid;
                border-width: thin;
            }

        .summary-pair {
            width: 15%;
        }

        .loader {
            position: fixed;
            left: 45%;
            top: 35%;
            width: 150px;
            height: 150px;
            z-index: 9999;
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <!--<div class="title">
        DTS. Dashboard.
    </div>-->
    <div id="loader" class="loader"></div>
    <div>
        <div id="casetotal" class="summary" style="background-color: #454545">
            <div class="subject">
                Case Total
            </div>
            <div class="content"></div>
        </div>
        <div id="pendingtotal" class="summary" style="background-color: hotpink">
            <div class="subject">
                Pending
            </div>
            <div class="content"></div>
        </div>
        <div id="dtsefftotal" class="summary" style="background-color: deepskyblue">
            <div class="subject">
                Efficiency DTS. team
                <span>
                    <button><i class="fa fa-plus"></i></button>
                </span>
            </div>
            <div class="content"></div>
        </div>
        <div id="tlefftotal" class="summary summary-pair" style="background-color: lightseagreen">
            <div class="subject">
                TL. Eff.
                <span>
                    <button><i class="fa fa-plus"></i></button>
                </span>
            </div>
            <div class="content"></div>
        </div>
        <div id="ftsefftotal" class="summary summary-pair" style="background-color: gold">
            <div class="subject">
                FTS. Eff.
                <span>
                    <button><i class="fa fa-plus"></i></button>
                </span>
            </div>
            <div class="content"></div>
        </div>
    </div>
    <div>
        <div id="dailycase" class="mydashboard">
            <div class="content-box">
                <div class="subject">
                    Daily TL. Case (Date)
                </div>
                <div id="barchart1" class="content"></div>
            </div>
        </div>
        <div id="efficiency" class="mydashboard">
            <div class="content-box">
                <div class="subject">
                    Efficiency of DTS. Team. (Date)
                </div>
                <div id="graph1" class="content"></div>
            </div>
        </div>
        <div class="mydashboard">
            <div class="content-box">
                <div class="subject">
                    In Change Case
                </div>
                <div id="piechart" class="content"></div>
            </div>
        </div>
        <div class="mydashboard">
            <div class="content-box">
                <div class="subject">
                    Category Case of TL.
                </div>
                <div id="container1" class="content"></div>
            </div>
        </div>
        <div class="mydashboard">
            <div class="content-box">
                <div class="subject">
                    Scramble
                </div>
                <div id="container2" class="content"></div>
            </div>
        </div>
    </div>
</body>
</html>

<script type="text/javascript">
    var api = "https://localhost:44370/";
    const today = new Date();

    $(document).ready(function () {
        showLoader(true);
        getCaseTotal();

        $("#dailycase .subject").text("Daily TL. Case (" + formatDate(today, "dd/mm/yyyy") + ")");
        $("#efficiency .subject").text("Efficiency of DTS. Team. (" + formatDate(today, "dd/mm/yyyy") + ")");
        
        google.charts.setOnLoadCallback(function () { getDailyTLCase() });
        google.charts.setOnLoadCallback(function () { getEfficiencyDTSTeam() });
        google.charts.setOnLoadCallback(function () { getInChargeCase() });
        google.charts.setOnLoadCallback(function () { getCategoryCase() });
        google.charts.setOnLoadCallback(function () { getScramble() });
        
        google.charts.setOnLoadCallback(function () {
            // Everything you want to happen after loading goes here
            showLoader(false);
        });
    });

    function showLoader(status) {
        if (status) {
            $("#loader").show();
        }
        else {
            $("#loader").hide();
        }
    }

    function getCaseTotal() {        
        $.ajax({
            type: 'GET',
            url: api + '/api/cdf/get/total',
            //data: formdata,
            contentType: false,
            processData: false,
            async: false,
            success: function (result) {
                $("#casetotal").find(".content").html(result.CaseTotal.toLocaleString());
                $("#pendingtotal").find(".content").html(result.Pending.toLocaleString());
                $("#dtsefftotal").find(".content").html(result.DtsEff.toLocaleString() + '<i class="fa fa-percent"></i>');
                $("#tlefftotal").find(".content").html(result.TlEff.toLocaleString() + '<i class="fa fa-percent"></i>');
                $("#ftsefftotal").find(".content").html(result.FtsEff.toLocaleString() + '<i class="fa fa-percent"></i>');
            },
            error: function (xhr, status, error) {
                $("#casetotal").find(".content").html(0);
                $("#pendingtotal").find(".content").html(0);
                $("#dtsefftotal").find(".content").html(0);
                $("#tlefftotal").find(".content").html(0);
                $("#ftsefftotal").find(".content").html(0);
            }
        });
    }

    function getDailyTLCase() {
        var rawdata = [];

        $.ajax({
            type: 'GET',
            url: api + '/api/cdf/get/dailycase',
            //data: formdata,
            contentType: false,
            processData: false,
            async: false,
            success: function (result) {               
                rawdata.push(result.Header);

                for (var i = 0; i < result.Detail.length; i++) {
                    var temp = [];
                    var chartsdata = result.Detail[i];

                    temp.push(chartsdata.Subject);

                    for (var j = 0; j < chartsdata.Value.length; j++) {
                        temp.push(chartsdata.Value[j]);
                    }

                    rawdata.push(temp);
                }
            },
            error: function (xhr, status, error) {
                rawdata.push(null);
            }
        });

        var data = new google.visualization.arrayToDataTable(rawdata);
        drawColumnChart("barchart1", data);
    }

    function getEfficiencyDTSTeam() {
        var rawdata = [];

        $.ajax({
            type: 'GET',
            url: api + '/api/cdf/get/effdtsteam',
            //data: formdata,
            contentType: false,
            processData: false,
            async: false,
            success: function (result) {
                rawdata.push(result.Header);

                for (var i = 0; i < result.Detail.length; i++) {
                    var temp = [];
                    var chartsdata = result.Detail[i];

                    temp.push(chartsdata.Subject);

                    for (var j = 0; j < chartsdata.Value.length; j++) {
                        temp.push(chartsdata.Value[j]);
                    }

                    rawdata.push(temp);
                }
            },
            error: function (xhr, status, error) {
                rawdata.push(null);
            }
        });

        var data = new google.visualization.arrayToDataTable(rawdata);
        drawLineChart("graph1", data);
    }

    function getInChargeCase() {
        var rawdata = [];

        $.ajax({
            type: 'GET',
            url: api + '/api/cdf/get/inchargecase',
            //data: formdata,
            contentType: false,
            processData: false,
            async: false,
            success: function (result) {
                rawdata.push([result.Header, result.Detail]);

                for (var i = 0; i < result.Value.length; i++) {
                    var value = result.Value[i];
                    rawdata.push([value.Key, value.Value]);
                }
            },
            error: function (xhr, status, error) {
                rawdata.push([null, null]);
            }
        });

        // Changing legend  
        for (var i = 0; i < rawdata.length; i++) {
            rawdata[i][0] = rawdata[i][0] + " (" + rawdata[i][1] + ")";
        }

        var data = new google.visualization.arrayToDataTable(rawdata);
        drawPieChart("piechart", data);
    }

    function getCategoryCase() {
        var rawdata = [];

        $.ajax({
            type: 'GET',
            url: api + '/api/cdf/get/categorycase',
            //data: formdata,
            contentType: false,
            processData: false,
            async: false,
            success: function (result) {
                rawdata.push([result.Header, result.Detail]);

                for (var i = 0; i < result.Value.length; i++) {
                    var value = result.Value[i];
                    rawdata.push([value.Key, value.Value]);
                }
            },
            error: function (xhr, status, error) {
                rawdata.push([null, null]);
            }
        });

        var data = new google.visualization.arrayToDataTable(rawdata);
        drawBarChart("container1", data);
    }

    function getScramble() {
        var rawdata = [];

        $.ajax({
            type: 'GET',
            url: api + '/api/cdf/get/scramble',
            //data: formdata,
            contentType: false,
            processData: false,
            async: false,
            success: function (result) {
                rawdata.push([result.Header, result.Detail]);

                for (var i = 0; i < result.Value.length; i++) {
                    var value = result.Value[i];
                    rawdata.push([value.Key, value.Value]);
                }
            },
            error: function (xhr, status, error) {
                rawdata.push([null, null]);
            }
        });

        var data = new google.visualization.arrayToDataTable(rawdata);
        drawBarChart("container2", data);
    }

    function drawColumnChart(myid, data) {
        var view = new google.visualization.DataView(data);
        view.setColumns([0,
            1,
            {
                calc: "stringify",
                sourceColumn: 1,
                type: "string",
                role: "annotation"
            },
            2,
            {
                calc: "stringify",
                sourceColumn: 2,
                type: "string",
                role: "annotation"
            },
            3,
            {
                calc: "stringify",
                sourceColumn: 3,
                type: "string",
                role: "annotation"
            }
        ]);

        var options = {
            bar: {
                groupWidth: "50%"
            },
            chartArea: {
                width: '80%',
            },
            legend: {
                position: 'top',
                alignment: 'center',
            },
            hAxis: {
                title: 'Tech Line Case',
                titleTextStyle: {
                    top: 5,
                    fontSize: 11,
                    color: 'grey'
                },
                textStyle: {
                    fontSize: 11
                },
                gridlines: {
                    color: 'transparent'
                },
                //textPosition: 'none'
            },
            vAxis: {
                gridlines: { color: 'transparent' },
                minorGridlines: { color: 'transparent' },
                textPosition: 'none'
            },
            colors: [
                '#FDCB66', '#6CB0F2',
                '#FCA481', '#aabf75',
            ]
        };

        var chart = new google.visualization.ColumnChart(document.getElementById(myid));
        chart.draw(view, options);
    }

    function drawLineChart(myid, data) {
        var view = new google.visualization.DataView(data);
        view.setColumns([0,
            1,
            {
                calc: "stringify",
                sourceColumn: 1,
                type: "string",
                role: "annotation"
            },
            2, 3
        ]);

        var options = {
            chartArea: {
                width: "95%",
                height: "60%"
            },
            legend: {
                position: 'top',
                alignment: 'center',
            },
            hAxis: {
                title: 'Performance of DTS. team',
                titleTextStyle: {
                    top: 5,
                    fontSize: 11,
                    color: 'grey'
                },
                textStyle: {
                    fontSize: 11
                },
                gridlines: {
                    color: 'transparent'
                },
                //textPosition: 'none'
            },
            vAxis: {
                gridlines: { color: 'transparent' },
                minorGridlines: { color: 'transparent' },
                textPosition: 'none'
            },
            annotations: {
                textStyle: {
                    color: 'black',
                    fontSize: 10
                },
                stemColor: 'none',
            },
            pointSize: 3,
            colors: [
                '#FDCB66', '#6CB0F2',
                '#FCA481', '#aabf75',
            ]
        };

        var chart = new google.visualization.LineChart(document.getElementById(myid));
        chart.draw(view, options);
    }

    function drawPieChart(myid, data) {
        var options = {
            chartArea: {
                width: '80%',
                height: '80%'
            },
            pieSliceText: "none",
            legend: {
                position: 'labeled',
                alignment: 'start',
                textStyle: {
                    fontSize: 11
                },
            },
            tooltip: {
                trigger: 'none'
            },
            isStacked: 'percent',
            colors: [
                '#9CDEF6', '#6CB0F2',
                '#FCA481', '#FDCB66',
                '#aabf75',
            ],
        };

        var chart = new google.visualization.PieChart(document.getElementById(myid));
        chart.draw(data, options);
    }

    function drawBarChart(myid, data) {
        var view = new google.visualization.DataView(data);
        view.setColumns([0,
            1,
            {
                calc: "stringify",
                sourceColumn: 1,
                type: "string",
                role: "annotation"
            }
        ]);

        var options = {
            isStacked: true,
            legend: 'none',
            hAxis: {
                gridlines: {
                    color: 'transparent'
                },
                textPosition: 'none'
            },
            annotations: {
                textStyle: {
                    color: 'black'
                },
                stemColor: 'none',
                alwaysOutside: true
            },
            chartArea: {
                left: 125,
                width: '100%',
                height: '80%'
            },
            tooltip: {
                trigger: 'none'
            },
            colors: [
                '#FDCB66', '#6CB0F2',
                '#FCA481', '#aabf75',
            ]
        };
        /* Instantiate and draw the chart.*/
        var chart = new google.visualization.BarChart(document.getElementById(myid));
        chart.draw(view, options);
    }

    function formatDate(date, format) {
        const map = {
            mm: padDigits(date.getMonth() + 1, 2),
            dd: padDigits(date.getDate(), 2),
            yy: date.getFullYear().toString().slice(-2),
            yyyy: date.getFullYear()
        }

        return format.replace(/mm|dd|yyyy|yy|yyy/gi, matched => map[matched])
    }

    function padDigits(number, digits) {
        return Array(Math.max(digits - String(number).length + 1, 0)).join(0) + number;
    }

    $("#dtsefftotal button").click(function () {
        alert('hello 1');
    });

    $("#tlefftotal button").click(function () {
        alert('hello 2');
    });

    $("#ftsefftotal button").click(function () {
        alert('hello 3');
    });
</script>